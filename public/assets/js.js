$(document).ready(function(){$(".input-tip").tipTip({activation:"hover",defaultPosition:"right"});$(".twitter-shared").tipTip({activation:"hover",defaultPosition:"right"});$(".setting-icon").tipTip({activation:"hover",defaultPosition:"right"});$(".input-tip-bottom").tipTip({activation:"hover",defaultPosition:"bottom"});$("#user_timezone").tipTip({activation:"focus",defaultPosition:"right"});$(".setting-icon").click(function(){$(this).replaceWith("<p><strong>Please wait...</strong></p>")});$("#tour").colorbox({iframe:true,innerWidth:425,innerHeight:344});$(".facebook-shared, .twitter-shared, .foursquare-shared").hide();$("#search").attr("tabindex",10);$("#calendar_event").focus();function b(){$("#pageinfo").load("/ #pageinfo");$("#pageinfo").load("/ #feed_item_today_container");return false}$("#signin-link").colorbox({opacity:0.1,inline:true,href:function(){return $(this).attr("href")}});$("input:text:visible:first").focus();$(".delete-icon").bind("ajax:success",function(){$(this).closest("tr").fadeOut("linear",b)});$("#feed_item_today,#feed_item_past,#feed_item_tomorrow").find("tbody tr").each(function(){if($(this).attr("class")=="true"){$(this).fadeTo("slow",0.4);$(this).find(".event-span").find("a").css("textDecoration","line-through")}});$(".done-icon").bind("ajax:success",function(){var h=$(this).closest("tr").attr("class");if(h==""||h=="false"){$(this).closest("tr").attr("class","true");$(this).closest("tr").fadeTo("slow",0.4).find(".event-span").find("a").css("textDecoration","line-through")}else{$(this).closest("tr").attr("class","false");$(this).closest("tr").fadeTo("slow",1).find(".event-span").find("a").css("textDecoration","none")}});$("input:text,input:password").focus(function(){$(this).addClass("selected-input")});$("input:text,input:password").blur(function(){$(this).removeClass("selected-input")});$("form").submit(function(){$('input[type="submit"]',this).replaceWith("<p><strong>Please wait...</strong></p>")});setTimeout(g,10000);function g(){$("#flash_alert,#flash_success,#flash_notice,#setting-error").fadeOut(2000)}$("#editcal").dialog({autoOpen:false,height:300,width:350,modal:true,buttons:{Ok:function(){},Cancel:function(){$(this).dialog("close")}},close:function(){allFields.val("").removeClass("ui-state-error")}});setInterval(function(){var k=new Date();var h=k.getTime();var i=h.toString().substring(0,10);$("#feed_item_today :input").each(function(){elemVal=$(this).val();if(elemVal==i){msg=$(this).attr("name");$.pnotify({pnotify_title:"Reminder",pnotify_text:msg,pnotify_opacity:0.8})}});$(".foursquare-shared,.facebook-shared,.twitter-shared").each(function(){if($(this).attr("rel")=="true"){$(this).show("slow")}})},1000);$('a[rel^="map-"]').colorbox({opacity:0.2,inline:true,href:function(){return"#"+$(this).attr("rel")},onComplete:function(){$("#"+$(this).attr("rel")).each(function(){$(this).css("z-index","1");var n=$(this).attr("title");var k=n.split(",");lat=k[0];lon=k[1];loc=k[2];var h=[loc];var i;i=new mxn.Mapstraction($(this).attr("id"),"google");var l=new mxn.LatLonPoint(lat,lon);i.setCenterAndZoom(l,16);i.addControls({pan:true,zoom:"large",map_type:true});my_marker=new mxn.Marker(l);var m=loc;my_marker.setInfoBubble(m);i.addMarker(my_marker)})}});$(".map-icon").hide();$('a[rel^="map-"]').hover(function(){$(this).next(".map-icon").show(slow)},function(){$(this).next(".map-icon").hide(slow)});$('a[id^="edit-form-link-"],a[id^="inline-edit-note-link-"]').colorbox({transition:"elastic",opacity:0.3,inline:true,href:function(){return $(this).attr("href")}});$('div[id^="inline-edit-form-"]').css("padding","6px");$('div[id^="inline-edit-form-"]').find("label").css("padding","5px");$('div[id^="inline-edit-form-"]').find("input").css("float","left");var e="dropdown-active",a,f,d;var c=function(){if(a){a.removeClass(e);f.hide()}};$(".dropdown").each(function(){var l=$(this);var k=l.next("div.dropdown-menu"),i=l.parent();var h=function(){c();a=l.addClass("dropdown-active");f=k.show();d=i};l.bind("click",function(m){if(m){m.stopPropagation()}if(m){m.preventDefault()}h()});l.bind("focus",function(){h()})});$(document.body).bind("click",function(i){if(d){var h=d[0];if(!$.contains(h,i.target)||!h==i.target){c()}}})});(function(a9,aK){var aR="none",aq="LoadedContent",a8=false,aP="resize.",aW="y",aU="auto",a6=true,ar="nofollow",aY="x";function a5(b,d){b=b?' id="'+a2+b+'"':"";d=d?' style="'+d+'"':"";return a9("<div"+b+d+"/>")}function aV(d,c){c=c===aY?aX.width():aX.height();return typeof d==="string"?Math.round(/%/.test(d)?c/100*parseInt(d,10):parseInt(d,10)):d}function ai(a){return ba.photo||/\.(gif|png|jpg|jpeg|bmp)(?:\?([^#]*))?(?:#(\.*))?$/i.test(a)}function aI(b){for(var d in b){if(a9.isFunction(b[d])&&d.substring(0,2)!=="on"){b[d]=b[d].call(aZ)}}b.rel=b.rel||aZ.rel||ar;b.href=b.href||a9(aZ).attr("href");b.title=b.title||aZ.title;return b}function aO(d,b){b&&b.call(aZ);a9.event.trigger(d)}function aH(){var a,h=a2+"Slideshow_",i="click."+a2,g,d;if(ba.slideshow&&a3[1]){g=function(){ay.text(ba.slideshowStop).unbind(i).bind(ah,function(){if(a4<a3.length-1||ba.loop){a=setTimeout(a7.next,ba.slideshowSpeed)}}).bind(ag,function(){clearTimeout(a)}).one(i+" "+ap,d);a1.removeClass(h+"off").addClass(h+"on");a=setTimeout(a7.next,ba.slideshowSpeed)};d=function(){clearTimeout(a);ay.text(ba.slideshowStart).unbind([ah,ag,ap,i].join(" ")).one(i,g);a1.removeClass(h+"on").addClass(h+"off")};ba.slideshowAuto?g():d()}}function aF(b){if(!ao){aZ=b;ba=aI(a9.extend({},a9.data(aZ,aT)));a3=a9(aZ);a4=0;if(ba.rel!==ar){a3=a9("."+ax).filter(function(){return(a9.data(this,aT).rel||this.rel)===ba.rel});a4=a3.index(aZ);if(a4===-1){a3=a3.add(aZ);a4=a3.length-1}}if(!aQ){aQ=aA=a6;a1.show();if(ba.returnFocus){try{aZ.blur();a9(aZ).one(aa,function(){try{this.focus()}catch(c){}})}catch(a){}}aN.css({opacity:+ba.opacity,cursor:ba.overlayClose?"pointer":aU}).show();ba.w=aV(ba.initialWidth,aY);ba.h=aV(ba.initialHeight,aW);a7.position(0);af&&aX.bind(aP+an+" scroll."+an,function(){aN.css({width:aX.width(),height:aX.height(),top:aX.scrollTop(),left:aX.scrollLeft()})}).trigger("scroll."+an);aO(aJ,ba.onOpen);ae.add(aw).add(av).add(ay).add(ad).hide();aD.html(ba.close).show()}a7.load(a6)}}var aG={transition:"elastic",speed:300,width:a8,initialWidth:"600",innerWidth:a8,maxWidth:a8,height:a8,initialHeight:"450",innerHeight:a8,maxHeight:a8,scalePhotos:a6,scrolling:a6,inline:a8,html:a8,iframe:a8,photo:a8,href:a8,title:a8,rel:a8,opacity:0.9,preloading:a6,current:"image {current} of {total}",previous:"previous",next:"next",close:"close",open:a8,returnFocus:a6,loop:a6,slideshow:a8,slideshowAuto:a6,slideshowSpeed:2500,slideshowStart:"start slideshow",slideshowStop:"stop slideshow",onOpen:a8,onLoad:a8,onComplete:a8,onCleanup:a8,onClosed:a8,overlayClose:a6,escKey:a6,arrowKey:a6},aT="colorbox",a2="cbox",aJ=a2+"_open",ag=a2+"_load",ah=a2+"_complete",ap=a2+"_cleanup",aa=a2+"_closed",am=a2+"_purge",ac=a2+"_loaded",az=a9.browser.msie&&!a9.support.opacity,af=az&&a9.browser.version<7,an=a2+"_IE6",aN,a1,aE,aS,bc,aj,al,ak,a3,aX,a0,au,at,ad,ae,ay,av,aw,aD,aC,aB,aM,aL,aZ,a4,ba,aQ,aA,ao=a8,a7,ax=a2+"Element";a7=a9.fn[aT]=a9[aT]=function(h,e){var b=this,g;if(!b[0]&&b.selector){return b}h=h||{};if(e){h.onComplete=e}if(!b[0]||b.selector===undefined){b=a9("<a/>");h.open=a6}b.each(function(){a9.data(this,aT,a9.extend({},a9.data(this,aT)||aG,h));a9(this).addClass(ax)});g=h.open;if(a9.isFunction(g)){g=g.call(b)}g&&aF(b[0]);return b};a7.init=function(){var b="hover",a="clear:left";aX=a9(aK);a1=a5().attr({id:aT,"class":az?a2+"IE":""});aN=a5("Overlay",af?"position:absolute":"").hide();aE=a5("Wrapper");aS=a5("Content").append(a0=a5(aq,"width:0; height:0; overflow:hidden"),at=a5("LoadingOverlay").add(a5("LoadingGraphic")),ad=a5("Title"),ae=a5("Current"),av=a5("Next"),aw=a5("Previous"),ay=a5("Slideshow").bind(aJ,aH),aD=a5("Close"));aE.append(a5().append(a5("TopLeft"),bc=a5("TopCenter"),a5("TopRight")),a5(a8,a).append(aj=a5("MiddleLeft"),aS,al=a5("MiddleRight")),a5(a8,a).append(a5("BottomLeft"),ak=a5("BottomCenter"),a5("BottomRight"))).children().children().css({"float":"left"});au=a5(a8,"position:absolute; width:9999px; visibility:hidden; display:none");a9("body").prepend(aN,a1.append(aE,au));aS.children().hover(function(){a9(this).addClass(b)},function(){a9(this).removeClass(b)}).addClass(b);aC=bc.height()+ak.height()+aS.outerHeight(a6)-aS.height();aB=aj.width()+al.width()+aS.outerWidth(a6)-aS.width();aM=a0.outerHeight(a6);aL=a0.outerWidth(a6);a1.css({"padding-bottom":aC,"padding-right":aB}).hide();av.click(a7.next);aw.click(a7.prev);aD.click(a7.close);aS.children().removeClass(b);a9("."+ax).live("click",function(c){if(!(c.button!==0&&typeof c.button!=="undefined"||c.ctrlKey||c.shiftKey||c.altKey)){c.preventDefault();aF(this)}});aN.click(function(){ba.overlayClose&&a7.close()});a9(document).bind("keydown",function(c){if(aQ&&ba.escKey&&c.keyCode===27){c.preventDefault();a7.close()}if(aQ&&ba.arrowKey&&!aA&&a3[1]){if(c.keyCode===37&&(a4||ba.loop)){c.preventDefault();aw.click()}else{if(c.keyCode===39&&(a4<a3.length-1||ba.loop)){c.preventDefault();av.click()}}}})};a7.remove=function(){a1.add(aN).remove();a9("."+ax).die("click").removeData(aT).removeClass(ax)};a7.position=function(k,m){function a(b){bc[0].style.width=ak[0].style.width=aS[0].style.width=b.style.width;at[0].style.height=at[1].style.height=aS[0].style.height=aj[0].style.height=al[0].style.height=b.style.height}var l,c=Math.max(document.documentElement.clientHeight-ba.h-aM-aC,0)/2+aX.scrollTop(),i=Math.max(aX.width()-ba.w-aL-aB,0)/2+aX.scrollLeft();l=a1.width()===ba.w+aL&&a1.height()===ba.h+aM?0:k;aE[0].style.width=aE[0].style.height="9999px";a1.dequeue().animate({width:ba.w+aL,height:ba.h+aM,top:c,left:i},{duration:l,complete:function(){a(this);aA=a8;aE[0].style.width=ba.w+aL+aB+"px";aE[0].style.height=ba.h+aM+aC+"px";m&&m()},step:function(){a(this)}})};a7.resize=function(a){if(aQ){a=a||{};if(a.width){ba.w=aV(a.width,aY)-aL-aB}if(a.innerWidth){ba.w=aV(a.innerWidth,aY)}a0.css({width:ba.w});if(a.height){ba.h=aV(a.height,aW)-aM-aC}if(a.innerHeight){ba.h=aV(a.innerHeight,aW)}if(!a.innerHeight&&!a.height){a=a0.wrapInner("<div style='overflow:auto'></div>").children();ba.h=a.height();a.replaceWith(a.children())}a0.css({height:ba.h});a7.position(ba.transition===aR?0:ba.speed)}};a7.prep=function(a){var g="hidden";function b(i){var o,n,e,r,h=a3.length,k=ba.loop;a7.position(i,function(){function c(){az&&a1[0].style.removeAttribute("filter")}if(aQ){az&&f&&a0.fadeIn(100);a0.show();aO(ac);ad.show().html(ba.title);if(h>1){typeof ba.current==="string"&&ae.html(ba.current.replace(/\{current\}/,a4+1).replace(/\{total\}/,h)).show();av[k||a4<h-1?"show":"hide"]().html(ba.next);aw[k||a4?"show":"hide"]().html(ba.previous);o=a4?a3[a4-1]:a3[h-1];e=a4<h-1?a3[a4+1]:a3[0];ba.slideshow&&ay.show();if(ba.preloading){r=a9.data(e,aT).href||e.href;n=a9.data(o,aT).href||o.href;r=a9.isFunction(r)?r.call(e):r;n=a9.isFunction(n)?n.call(o):n;if(ai(r)){a9("<img/>")[0].src=r}if(ai(n)){a9("<img/>")[0].src=n}}}at.hide();ba.transition==="fade"?a1.fadeTo(d,1,function(){c()}):c();aX.bind(aP+a2,function(){a7.position(0)});aO(ah,ba.onComplete)}})}if(aQ){var f,d=ba.transition===aR?0:ba.speed;aX.unbind(aP+a2);a0.remove();a0=a5(aq).html(a);a0.hide().appendTo(au.show()).css({width:function(){ba.w=ba.w||a0.width();ba.w=ba.mw&&ba.mw<ba.w?ba.mw:ba.w;return ba.w}(),overflow:ba.scrolling?aU:g}).css({height:function(){ba.h=ba.h||a0.height();ba.h=ba.mh&&ba.mh<ba.h?ba.mh:ba.h;return ba.h}()}).prependTo(aS);au.hide();a9("#"+a2+"Photo").css({cssFloat:aR,marginLeft:aU,marginRight:aU});af&&a9("select").not(a1.find("select")).filter(function(){return this.style.visibility!==g}).css({visibility:g}).one(ap,function(){this.style.visibility="inherit"});ba.transition==="fade"?a1.fadeTo(d,0,function(){b(0)}):b(d)}};a7.load=function(a){var f,e,b,d=a7.prep;aA=a6;aZ=a3[a4];a||(ba=aI(a9.extend({},a9.data(aZ,aT))));aO(am);aO(ag,ba.onLoad);ba.h=ba.height?aV(ba.height,aW)-aM-aC:ba.innerHeight&&aV(ba.innerHeight,aW);ba.w=ba.width?aV(ba.width,aY)-aL-aB:ba.innerWidth&&aV(ba.innerWidth,aY);ba.mw=ba.w;ba.mh=ba.h;if(ba.maxWidth){ba.mw=aV(ba.maxWidth,aY)-aL-aB;ba.mw=ba.w&&ba.w<ba.mw?ba.w:ba.mw}if(ba.maxHeight){ba.mh=aV(ba.maxHeight,aW)-aM-aC;ba.mh=ba.h&&ba.h<ba.mh?ba.h:ba.mh}f=ba.href;at.show();if(ba.inline){a5().hide().insertBefore(a9(f)[0]).one(am,function(){a9(this).replaceWith(a0.children())});d(a9(f))}else{if(ba.iframe){a1.one(ac,function(){var g=a9("<iframe frameborder='0' style='width:100%; height:100%; border:0; display:block'/>")[0];g.name=a2+ +new Date;g.src=ba.href;if(!ba.scrolling){g.scrolling="no"}if(az){g.allowtransparency="true"}a9(g).appendTo(a0).one(am,function(){g.src="//about:blank"})});d(" ")}else{if(ba.html){d(ba.html)}else{if(ai(f)){e=new Image;e.onload=function(){var c;e.onload=null;e.id=a2+"Photo";a9(e).css({border:aR,display:"block",cssFloat:"left"});if(ba.scalePhotos){b=function(){e.height-=e.height*c;e.width-=e.width*c};if(ba.mw&&e.width>ba.mw){c=(e.width-ba.mw)/e.width;b()}if(ba.mh&&e.height>ba.mh){c=(e.height-ba.mh)/e.height;b()}}if(ba.h){e.style.marginTop=Math.max(ba.h-e.height,0)/2+"px"}a3[1]&&(a4<a3.length-1||ba.loop)&&a9(e).css({cursor:"pointer"}).click(a7.next);if(az){e.style.msInterpolationMode="bicubic"}setTimeout(function(){d(e)},1)};setTimeout(function(){e.src=f},1)}else{f&&au.load(f,function(h,i,g){d(i==="error"?"Request unsuccessful: "+g.statusText:a9(this).children())})}}}}};a7.next=function(){if(!aA){a4=a4<a3.length-1?a4+1:0;a7.load()}};a7.prev=function(){if(!aA){a4=a4?a4-1:a3.length-1;a7.load()}};a7.close=function(){if(aQ&&!ao){ao=a6;aQ=a8;aO(ap,ba.onCleanup);aX.unbind("."+a2+" ."+an);aN.fadeTo("fast",0);a1.stop().fadeTo("fast",0,function(){aO(am);a0.remove();a1.add(aN).css({opacity:1,cursor:aU}).hide();setTimeout(function(){ao=a8;aO(aa,ba.onClosed)},1)})}};a7.element=function(){return a9(aZ)};a7.settings=aG;a9(a7.init)})(jQuery,this);(function(g){var a,d,f,c;g.extend({pnotify_remove_all:function(){var e=f.data("pnotify");e&&e.length&&g.each(e,function(){this.pnotify_remove&&this.pnotify_remove()})},pnotify_position_all:function(){d&&clearTimeout(d);d=null;var e=f.data("pnotify");if(e&&e.length){g.each(e,function(){var r=this.opts.pnotify_stack;if(r){if(!r.nextpos1){r.nextpos1=r.firstpos1}if(!r.nextpos2){r.nextpos2=r.firstpos2}if(!r.addpos2){r.addpos2=0}if(this.css("display")!="none"){var m,n,p={},k;switch(r.dir1){case"down":k="top";break;case"up":k="bottom";break;case"left":k="right";break;case"right":k="left";break}m=parseInt(this.css(k));if(isNaN(m)){m=0}if(typeof r.firstpos1=="undefined"){r.firstpos1=m;r.nextpos1=r.firstpos1}var q;switch(r.dir2){case"down":q="top";break;case"up":q="bottom";break;case"left":q="right";break;case"right":q="left";break}n=parseInt(this.css(q));if(isNaN(n)){n=0}if(typeof r.firstpos2=="undefined"){r.firstpos2=n;r.nextpos2=r.firstpos2}if(r.dir1=="down"&&r.nextpos1+this.height()>c.height()||r.dir1=="up"&&r.nextpos1+this.height()>c.height()||r.dir1=="left"&&r.nextpos1+this.width()>c.width()||r.dir1=="right"&&r.nextpos1+this.width()>c.width()){r.nextpos1=r.firstpos1;r.nextpos2+=r.addpos2+10;r.addpos2=0}if(r.animation&&r.nextpos2<n){switch(r.dir2){case"down":p.top=r.nextpos2+"px";break;case"up":p.bottom=r.nextpos2+"px";break;case"left":p.right=r.nextpos2+"px";break;case"right":p.left=r.nextpos2+"px";break}}else{this.css(q,r.nextpos2+"px")}switch(r.dir2){case"down":case"up":if(this.outerHeight(true)>r.addpos2){r.addpos2=this.height()}break;case"left":case"right":if(this.outerWidth(true)>r.addpos2){r.addpos2=this.width()}break}if(r.nextpos1){if(r.animation&&(m>r.nextpos1||p.top||p.bottom||p.right||p.left)){switch(r.dir1){case"down":p.top=r.nextpos1+"px";break;case"up":p.bottom=r.nextpos1+"px";break;case"left":p.right=r.nextpos1+"px";break;case"right":p.left=r.nextpos1+"px";break}}else{this.css(k,r.nextpos1+"px")}}if(p.top||p.bottom||p.right||p.left){this.animate(p,{duration:500,queue:false})}switch(r.dir1){case"down":case"up":r.nextpos1+=this.height()+10;break;case"left":case"right":r.nextpos1+=this.width()+10;break}}}});g.each(e,function(){var k=this.opts.pnotify_stack;if(k){k.nextpos1=k.firstpos1;k.nextpos2=k.firstpos2;k.addpos2=0;k.animation=true}})}},pnotify:function(r){f||(f=g("body"));c||(c=g(window));var s,m;if(typeof r!="object"){m=g.extend({},g.pnotify.defaults);m.pnotify_text=r}else{m=g.extend({},g.pnotify.defaults,r)}if(m.pnotify_before_init){if(m.pnotify_before_init(m)===false){return null}}var n,p=function(x,v){e.css("display","none");var w=document.elementFromPoint(x.clientX,x.clientY);e.css("display","block");var u=g(w),t=u.css("cursor");e.css("cursor",t!="auto"?t:"default");if(!n||n.get(0)!=w){if(n){b.call(n.get(0),"mouseleave",x.originalEvent);b.call(n.get(0),"mouseout",x.originalEvent)}b.call(w,"mouseenter",x.originalEvent);b.call(w,"mouseover",x.originalEvent)}b.call(w,v,x.originalEvent);n=u},e=g("<div />",{"class":"ui-pnotify "+m.pnotify_addclass,css:{display:"none"},mouseenter:function(t){m.pnotify_nonblock&&t.stopPropagation();if(m.pnotify_mouse_reset&&s=="out"){e.stop(true);s="in";e.css("height","auto").animate({width:m.pnotify_width,opacity:m.pnotify_nonblock?m.pnotify_nonblock_opacity:m.pnotify_opacity},"fast")}m.pnotify_nonblock&&e.animate({opacity:m.pnotify_nonblock_opacity},"fast");m.pnotify_hide&&m.pnotify_mouse_reset&&e.pnotify_cancel_remove();m.pnotify_closer&&!m.pnotify_nonblock&&e.closer.show()},mouseleave:function(t){m.pnotify_nonblock&&t.stopPropagation();n=null;e.css("cursor","auto");m.pnotify_nonblock&&s!="out"&&e.animate({opacity:m.pnotify_opacity},"fast");m.pnotify_hide&&m.pnotify_mouse_reset&&e.pnotify_queue_remove();e.closer.hide();g.pnotify_position_all()},mouseover:function(t){m.pnotify_nonblock&&t.stopPropagation()},mouseout:function(t){m.pnotify_nonblock&&t.stopPropagation()},mousemove:function(t){if(m.pnotify_nonblock){t.stopPropagation();p(t,"onmousemove")}},mousedown:function(t){if(m.pnotify_nonblock){t.stopPropagation();t.preventDefault();p(t,"onmousedown")}},mouseup:function(t){if(m.pnotify_nonblock){t.stopPropagation();t.preventDefault();p(t,"onmouseup")}},click:function(t){if(m.pnotify_nonblock){t.stopPropagation();p(t,"onclick")}},dblclick:function(t){if(m.pnotify_nonblock){t.stopPropagation();p(t,"ondblclick")}}});e.opts=m;if(m.pnotify_shadow&&!g.browser.msie){e.shadow_container=g("<div />",{"class":"ui-widget-shadow ui-corner-all ui-pnotify-shadow"}).prependTo(e)}e.container=g("<div />",{"class":"ui-widget ui-widget-content ui-corner-all ui-pnotify-container "+(m.pnotify_type=="error"?"ui-state-error":"ui-state-highlight")}).appendTo(e);e.pnotify_version="1.0.1";e.pnotify=function(u){var t=m;if(typeof u=="string"){m.pnotify_text=u}else{m=g.extend({},m,u)}e.opts=m;if(m.pnotify_shadow!=t.pnotify_shadow){if(m.pnotify_shadow&&!g.browser.msie){e.shadow_container=g("<div />",{"class":"ui-widget-shadow ui-pnotify-shadow"}).prependTo(e)}else{e.children(".ui-pnotify-shadow").remove()}}if(m.pnotify_addclass===false){e.removeClass(t.pnotify_addclass)}else{m.pnotify_addclass!==t.pnotify_addclass&&e.removeClass(t.pnotify_addclass).addClass(m.pnotify_addclass)}if(m.pnotify_title===false){e.title_container.hide("fast")}else{m.pnotify_title!==t.pnotify_title&&e.title_container.html(m.pnotify_title).show(200)}if(m.pnotify_text===false){e.text_container.hide("fast")}else{if(m.pnotify_text!==t.pnotify_text){if(m.pnotify_insert_brs){m.pnotify_text=m.pnotify_text.replace(/\n/g,"<br />")}e.text_container.html(m.pnotify_text).show(200)}}e.pnotify_history=m.pnotify_history;m.pnotify_type!=t.pnotify_type&&e.container.toggleClass("ui-state-error ui-state-highlight");if(m.pnotify_notice_icon!=t.pnotify_notice_icon&&m.pnotify_type=="notice"||m.pnotify_error_icon!=t.pnotify_error_icon&&m.pnotify_type=="error"||m.pnotify_type!=t.pnotify_type){e.container.find("div.ui-pnotify-icon").remove();if(m.pnotify_error_icon&&m.pnotify_type=="error"||m.pnotify_notice_icon){g("<div />",{"class":"ui-pnotify-icon"}).append(g("<span />",{"class":m.pnotify_type=="error"?m.pnotify_error_icon:m.pnotify_notice_icon})).prependTo(e.container)}}m.pnotify_width!==t.pnotify_width&&e.animate({width:m.pnotify_width});m.pnotify_min_height!==t.pnotify_min_height&&e.container.animate({minHeight:m.pnotify_min_height});m.pnotify_opacity!==t.pnotify_opacity&&e.fadeTo(m.pnotify_animate_speed,m.pnotify_opacity);if(m.pnotify_hide){t.pnotify_hide||e.pnotify_queue_remove()}else{e.pnotify_cancel_remove()}e.pnotify_queue_position();return e};e.pnotify_queue_position=function(){d&&clearTimeout(d);d=setTimeout(g.pnotify_position_all,10)};e.pnotify_display=function(){e.parent().length||e.appendTo(f);if(m.pnotify_before_open){if(m.pnotify_before_open(e)===false){return}}e.pnotify_queue_position();if(m.pnotify_animation=="fade"||m.pnotify_animation.effect_in=="fade"){e.show().fadeTo(0,0).hide()}else{m.pnotify_opacity!=1&&e.show().fadeTo(0,m.pnotify_opacity).hide()}e.animate_in(function(){m.pnotify_after_open&&m.pnotify_after_open(e);e.pnotify_queue_position();m.pnotify_hide&&e.pnotify_queue_remove()})};e.pnotify_remove=function(){if(e.timer){window.clearTimeout(e.timer);e.timer=null}if(m.pnotify_before_close){if(m.pnotify_before_close(e)===false){return}}e.animate_out(function(){if(m.pnotify_after_close){if(m.pnotify_after_close(e)===false){return}}e.pnotify_queue_position();m.pnotify_remove&&e.detach()})};e.animate_in=function(u){s="in";var t;t=typeof m.pnotify_animation.effect_in!="undefined"?m.pnotify_animation.effect_in:m.pnotify_animation;if(t=="none"){e.show();u()}else{if(t=="show"){e.show(m.pnotify_animate_speed,u)}else{if(t=="fade"){e.show().fadeTo(m.pnotify_animate_speed,m.pnotify_opacity,u)}else{if(t=="slide"){e.slideDown(m.pnotify_animate_speed,u)}else{if(typeof t=="function"){t("in",u,e)}else{e.effect&&e.effect(t,{},m.pnotify_animate_speed,u)}}}}}};e.animate_out=function(u){s="out";var t;t=typeof m.pnotify_animation.effect_out!="undefined"?m.pnotify_animation.effect_out:m.pnotify_animation;if(t=="none"){e.hide();u()}else{if(t=="show"){e.hide(m.pnotify_animate_speed,u)}else{if(t=="fade"){e.fadeOut(m.pnotify_animate_speed,u)}else{if(t=="slide"){e.slideUp(m.pnotify_animate_speed,u)}else{if(typeof t=="function"){t("out",u,e)}else{e.effect&&e.effect(t,{},m.pnotify_animate_speed,u)}}}}}};e.pnotify_cancel_remove=function(){e.timer&&window.clearTimeout(e.timer)};e.pnotify_queue_remove=function(){e.pnotify_cancel_remove();e.timer=window.setTimeout(function(){e.pnotify_remove()},isNaN(m.pnotify_delay)?0:m.pnotify_delay)};e.closer=g("<div />",{"class":"ui-pnotify-closer",css:{cursor:"pointer",display:"none"},click:function(){e.pnotify_remove();e.closer.hide()}}).append(g("<span />",{"class":"ui-icon ui-icon-circle-close"})).appendTo(e.container);if(m.pnotify_error_icon&&m.pnotify_type=="error"||m.pnotify_notice_icon){g("<div />",{"class":"ui-pnotify-icon"}).append(g("<span />",{"class":m.pnotify_type=="error"?m.pnotify_error_icon:m.pnotify_notice_icon})).appendTo(e.container)}e.title_container=g("<div />",{"class":"ui-pnotify-title",html:m.pnotify_title}).appendTo(e.container);m.pnotify_title===false&&e.title_container.hide();if(m.pnotify_insert_brs&&typeof m.pnotify_text=="string"){m.pnotify_text=m.pnotify_text.replace(/\n/g,"<br />")}e.text_container=g("<div />",{"class":"ui-pnotify-text",html:m.pnotify_text}).appendTo(e.container);m.pnotify_text===false&&e.text_container.hide();typeof m.pnotify_width=="string"&&e.css("width",m.pnotify_width);typeof m.pnotify_min_height=="string"&&e.container.css("min-height",m.pnotify_min_height);e.pnotify_history=m.pnotify_history;var q=f.data("pnotify");if(q==null||typeof q!="object"){q=[]}q=m.pnotify_stack.push=="top"?g.merge([e],q):g.merge(q,[e]);f.data("pnotify",q);m.pnotify_after_init&&m.pnotify_after_init(e);if(m.pnotify_history){var k=f.data("pnotify_history");if(typeof k=="undefined"){k=g("<div />",{"class":"ui-pnotify-history-container ui-state-default ui-corner-bottom",mouseleave:function(){k.animate({top:"-"+a+"px"},{duration:100,queue:false})}}).append(g("<div />",{"class":"ui-pnotify-history-header",text:"Redisplay"})).append(g("<button />",{"class":"ui-pnotify-history-all ui-state-default ui-corner-all",text:"All",mouseenter:function(){g(this).addClass("ui-state-hover")},mouseleave:function(){g(this).removeClass("ui-state-hover")},click:function(){g.each(q,function(){this.pnotify_history&&this.pnotify_display&&this.pnotify_display()});return false}})).append(g("<button />",{"class":"ui-pnotify-history-last ui-state-default ui-corner-all",text:"Last",mouseenter:function(){g(this).addClass("ui-state-hover")},mouseleave:function(){g(this).removeClass("ui-state-hover")},click:function(){for(var t=1;!q[q.length-t]||!q[q.length-t].pnotify_history||q[q.length-t].is(":visible");){if(q.length-t===0){return false}t++}t=q[q.length-t];t.pnotify_display&&t.pnotify_display();return false}})).appendTo(f);a=g("<span />",{"class":"ui-pnotify-history-pulldown ui-icon ui-icon-grip-dotted-horizontal",mouseenter:function(){k.animate({top:"0"},{duration:100,queue:false})}}).appendTo(k).offset().top+2;k.css({top:"-"+a+"px"});f.data("pnotify_history",k)}}m.pnotify_stack.animation=false;e.pnotify_display();return e}});var o=/^on/,l=/^(dbl)?click$|^mouse(move|down|up|over|out|enter|leave)$|^contextmenu$/,i=/^(focus|blur|select|change|reset)$|^key(press|down|up)$/,h=/^(scroll|resize|(un)?load|abort|error)$/,b=function(k,m){var e;k=k.toLowerCase();if(document.createEvent&&this.dispatchEvent){k=k.replace(o,"");if(k.match(l)){g(this).offset();e=document.createEvent("MouseEvents");e.initMouseEvent(k,m.bubbles,m.cancelable,m.view,m.detail,m.screenX,m.screenY,m.clientX,m.clientY,m.ctrlKey,m.altKey,m.shiftKey,m.metaKey,m.button,m.relatedTarget)}else{if(k.match(i)){e=document.createEvent("UIEvents");e.initUIEvent(k,m.bubbles,m.cancelable,m.view,m.detail)}else{if(k.match(h)){e=document.createEvent("HTMLEvents");e.initEvent(k,m.bubbles,m.cancelable)}}}e&&this.dispatchEvent(e)}else{k.match(o)||(k="on"+k);e=document.createEventObject(m);this.fireEvent(k,e)}};g.pnotify.defaults={pnotify_title:false,pnotify_text:false,pnotify_addclass:"",pnotify_nonblock:false,pnotify_nonblock_opacity:0.2,pnotify_history:true,pnotify_width:"300px",pnotify_min_height:"16px",pnotify_type:"notice",pnotify_notice_icon:"ui-icon ui-icon-info",pnotify_error_icon:"ui-icon ui-icon-alert",pnotify_animation:"fade",pnotify_animate_speed:"slow",pnotify_opacity:1,pnotify_shadow:false,pnotify_closer:true,pnotify_hide:true,pnotify_delay:8000,pnotify_mouse_reset:true,pnotify_remove:true,pnotify_insert_brs:true,pnotify_stack:{dir1:"down",dir2:"left",push:"bottom"}}})(jQuery);(function(a){a.fn.tipTip=function(c){var g={activation:"hover",keepAlive:false,maxWidth:"200px",edgeOffset:3,defaultPosition:"bottom",delay:400,fadeIn:200,fadeOut:200,attribute:"title",content:false,enter:function(){},exit:function(){}};var e=a.extend(g,c);if(a("#tiptip_holder").length<=0){var b=a('<div id="tiptip_holder" style="max-width:'+e.maxWidth+';"></div>');var d=a('<div id="tiptip_content"></div>');var f=a('<div id="tiptip_arrow"></div>');a("body").append(b.html(d).prepend(f.html('<div id="tiptip_arrow_inner"></div>')))}else{var b=a("#tiptip_holder");var d=a("#tiptip_content");var f=a("#tiptip_arrow")}return this.each(function(){var i=a(this);if(e.content){var m=e.content}else{var m=i.attr(e.attribute)}if(m!=""){if(!e.content){i.removeAttr(e.attribute)}var h=false;if(e.activation=="hover"){i.hover(function(){l()},function(){if(!e.keepAlive){k()}});if(e.keepAlive){b.hover(function(){},function(){k()})}}else{if(e.activation=="focus"){i.focus(function(){l()}).blur(function(){k()})}else{if(e.activation=="click"){i.click(function(){l();return false}).hover(function(){},function(){if(!e.keepAlive){k()}});if(e.keepAlive){b.hover(function(){},function(){k()})}}}}function l(){e.enter.call(this);d.html(m);b.hide().removeAttr("class").css("margin","0");f.removeAttr("style");var z=parseInt(i.offset()["top"]);var q=parseInt(i.offset()["left"]);var w=parseInt(i.outerWidth());var B=parseInt(i.outerHeight());var y=b.outerWidth();var t=b.outerHeight();var x=Math.round((w-y)/2);var p=Math.round((B-t)/2);var o=Math.round(q+x);var n=Math.round(z+B+e.edgeOffset);var u="";var D="";var v=Math.round(y-12)/2;if(e.defaultPosition=="bottom"){u="_bottom"}else{if(e.defaultPosition=="top"){u="_top"}else{if(e.defaultPosition=="left"){u="_left"}else{if(e.defaultPosition=="right"){u="_right"}}}}var s=(x+q)<parseInt(a(window).scrollLeft());var r=(y+q)>parseInt(a(window).width());if((s&&x<0)||(u=="_right"&&!r)||(u=="_left"&&q<(y+e.edgeOffset+5))){u="_right";D=Math.round(t-13)/2;v=-12;o=Math.round(q+w+e.edgeOffset);n=Math.round(z+p)}else{if((r&&x<0)||(u=="_left"&&!s)){u="_left";D=Math.round(t-13)/2;v=Math.round(y);o=Math.round(q-(y+e.edgeOffset+5));n=Math.round(z+p)}}var A=(z+B+e.edgeOffset+t+8)>parseInt(a(window).height()+a(window).scrollTop());var C=((z+B)-(e.edgeOffset+t+8))<0;if(A||(u=="_bottom"&&A)||(u=="_top"&&!C)){if(u=="_top"||u=="_bottom"){u="_top"}else{u=u+"_top"}D=t;n=Math.round(z-(t+5+e.edgeOffset))}else{if(C|(u=="_top"&&C)||(u=="_bottom"&&!A)){if(u=="_top"||u=="_bottom"){u="_bottom"}else{u=u+"_bottom"}D=-12;n=Math.round(z+B+e.edgeOffset)}}if(u=="_right_top"||u=="_left_top"){n=n+5}else{if(u=="_right_bottom"||u=="_left_bottom"){n=n-5}}if(u=="_left_top"||u=="_left_bottom"){o=o+5}f.css({"margin-left":v+"px","margin-top":D+"px"});b.css({"margin-left":o+"px","margin-top":n+"px"}).attr("class","tip"+u);if(h){clearTimeout(h)}h=setTimeout(function(){b.stop(true,true).fadeIn(e.fadeIn)},e.delay)}function k(){e.exit.call(this);if(h){clearTimeout(h)}b.fadeOut(e.fadeOut)}}})}})(jQuery);jQuery.url=function(){var e={};var b={};var d={url:window.location,strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var c=function(){str=decodeURI(d.url);var k=d.parser[d.strictMode?"strict":"loose"].exec(str);var n={};var l=14;while(l--){n[d.key[l]]=k[l]||""}n[d.q.name]={};n[d.key[12]].replace(d.q.parser,function(m,i,o){if(i){n[d.q.name][i]=o}});return n};var f=function(i){if(jQuery.isEmptyObject(b)){a()}if(i=="base"){if(b.port!==null&&b.port!==""){return b.protocol+"://"+b.host+":"+b.port+"/"}else{return b.protocol+"://"+b.host+"/"}}return(b[i]==="")?null:b[i]};var h=function(i){if(jQuery.isEmptyObject(b)){a()}return(b.queryKey[i]===null)?null:b.queryKey[i]};var a=function(){b=c();g()};var g=function(){var i=b.path;e=[];e=b.path.length==1?{}:(i.charAt(i.length-1)=="/"?i.substring(1,i.length-1):path=i.substring(1)).split("/")};return{setMode:function(i){d.strictMode=i=="strict"?true:false;return this},setUrl:function(i){d.url=i===undefined?window.location:i;a();return this},segment:function(i){if(jQuery.isEmptyObject(b)){a()}if(i===undefined){return e.length}return(e[i]===""||e[i]===undefined)?null:e[i]},attr:f,param:h}}();jQuery(function(g){var e=g("meta[name=csrf-token]").attr("content"),h=g("meta[name=csrf-param]").attr("content");g.fn.extend({triggerAndReturn:function(i,l){var k=new g.Event(i);this.trigger(k,l);return k.result!==false},callRemote:function(){var l=this,o=l.attr("method")||l.attr("data-method")||"GET",k=l.attr("action")||l.attr("href"),i=l.attr("data-type")||(g.ajaxSettings&&g.ajaxSettings.dataType);if(k===undefined){throw"No URL specified for remote call (action or href must be present)."}else{var n=g(this),m=l.is("form")?l.serializeArray():[];g.ajax({url:k,data:m,dataType:i,type:o.toUpperCase(),beforeSend:function(p){p.setRequestHeader("Accept","text/javascript");if(n.triggerHandler("ajax:beforeSend")===false){return false}},success:function(q,p,r){l.trigger("ajax:success",[q,p,r])},complete:function(p){l.trigger("ajax:complete",p)},error:function(r,p,q){l.trigger("ajax:error",[r,p,q])}})}}});g("body").delegate("a[data-confirm], button[data-confirm], input[data-confirm]","click.rails",function(){var i=g(this);if(i.triggerAndReturn("confirm")){if(!confirm(i.attr("data-confirm"))){return false}}});g("form[data-remote]").live("submit.rails",function(i){g(this).callRemote();i.preventDefault()});g("a[data-remote],input[data-remote]").live("click.rails",function(i){g(this).callRemote();i.preventDefault()});g("a[data-method]:not([data-remote])").live("click.rails",function(n){var m=g(this),k=m.attr("href"),o=m.attr("data-method"),l=g('<form method="post" action="'+k+'"></form>'),i='<input name="_method" value="'+o+'" type="hidden" />';if(h!==undefined&&e!==undefined){i+='<input name="'+h+'" value="'+e+'" type="hidden" />'}l.hide().append(i).appendTo("body");n.preventDefault();l.submit()});var c="input[data-disable-with]",d="form[data-remote]:has("+c+")",b="form:not([data-remote]):has("+c+")";var a=function(){g(this).find(c).each(function(){var i=g(this);i.data("enable-with",i.val()).attr("value",i.attr("data-disable-with")).attr("disabled","disabled")})};g(d).live("ajax:before.rails",a);g(b).live("submit.rails",a);g(d).live("ajax:complete.rails",function(){g(this).find(c).each(function(){var i=g(this);i.removeAttr("disabled").val(i.data("enable-with"))})});var f=g().jquery;if(!((f==="1.4.3")||(f==="1.4.4"))){alert("This rails.js does not support the jQuery version you are using. Please read documentation.")}});(function(){var q=null;var u="core";var t;var s=document.getElementsByTagName("script");for(var p=0;p<s.length;p++){var o=s[p].src.replace(/%20/g,"").match(/^(.*?)mxn\.js(\?\(\[?(.*?)\]?\))?$/);if(o!==null){t=o[1];if(o[3]){var v=o[3].split(",[");q=v[0].replace("]","");if(v[1]){u+=","+v[1]}}break}}if(q===null||q=="none"){return}q=q.replace(/ /g,"").split(",");u=u.replace(/ /g,"").split(",");var n='<script type="text/javascript" src="'+t+"mxn.";var i='.js"><\/script>';var w=[];for(p=0;p<u.length;p++){w.push(n+u[p]+i);for(var r=0;r<q.length;r++){w.push(n+q[r]+"."+u[p]+i)}}document.write(w.join(""))})();(function(){var h={};var e=function(a,b,c,k,d){if(!g(a,b,c)){throw"Method "+c+" of object "+b+" is not supported by API "+a+". Are you missing a script tag?"}if(typeof(h[a][b].deferrable)!="undefined"&&h[a][b].deferrable[c]===true){f.deferUntilLoaded.call(k,function(){return h[a][b][c].apply(k,d)})}else{return h[a][b][c].apply(k,d)}};var g=function(a,b,c){if(typeof(h[a])=="undefined"){throw"API "+a+" not loaded. Are you missing a script tag?"}if(typeof(h[a][b])=="undefined"){throw"Object definition "+b+" in API "+a+" not loaded. Are you missing a script tag?"}return typeof(h[a][b][c])=="function"};var f=window.mxn={register:function(a,b){if(!h.hasOwnProperty(a)){h[a]={}}f.util.merge(h[a],b)},addProxyMethods:function(c,a,d){for(var i=0;i<a.length;i++){var b=a[i];if(d){c.prototype[b]=new Function("return this.invoker.go('"+b+"', arguments, { overrideApi: true } );")}else{c.prototype[b]=new Function("return this.invoker.go('"+b+"', arguments);")}}},checkLoad:function(a){if(this.loaded[this.api]===false){var b=this;this.onload[this.api].push(function(){a.callee.apply(b,a)});return true}return false},deferUntilLoaded:function(b){if(this.loaded[this.api]===false){var a=this;this.onload[this.api].push(b)}else{b.call(this)}},addEvents:function(c,a){for(var d=0;d<a.length;d++){var b=a[d];if(b in c){throw"Event or method "+b+" already declared."}c[b]=new f.Event(b,c)}}};f.Event=function(a,b){var c=[];if(!a){throw"Event name must be provided"}this.addHandler=function(d,k){c.push({context:k,handler:d})};this.removeHandler=function(d,l){for(var i=0;i<c.length;i++){if(c[i].handler==d&&c[i].context==l){c.splice(i,1)}}};this.removeAllHandlers=function(){c=[]};this.fire=function(d){var l=[a,b,d];for(var i=0;i<c.length;i++){c[i].handler.apply(c[i].context,l)}}};f.Invoker=function(l,d,a){var b=l;var m=d;var n=a;var c={overrideApi:false,context:null,fallback:null};this.go=function(p,i,k){i=Array.prototype.slice.apply(i);if(typeof(k)=="undefined"){k=c}var q;if(k.overrideApi){q=i.shift()}else{q=n.apply(b)}if(typeof(q)!="string"){throw"API ID not available."}if(typeof(k.context)!="undefined"&&k.context!==null){i.push(k.context)}if(typeof(k.fallback)=="function"&&!g(q,m,p)){return k.fallback.apply(b,i)}else{return e(q,m,p,b,i)}}};f.util={merge:function(a,c){for(var b in c){if(c.hasOwnProperty(b)){if(!a.hasOwnProperty(b)){a[b]=c[b]}else{f.util.merge(a[b],c[b])}}}},$m:function(){var a=[];for(var b=0;b<arguments.length;b++){var c=arguments[b];if(typeof(c)=="string"){c=document.getElementById(c)}if(arguments.length==1){return c}a.push(c)}return a},loadScript:function(b,a){var d=document.createElement("script");d.type="text/javascript";d.src=b;if(a){if(d.addEventListener){d.addEventListener("load",a,true)}else{if(d.attachEvent){var k=false;d.attachEvent("onreadystatechange",function(){if(!k&&document.readyState==="complete"){k=true;a()}})}}}var c=document.getElementsByTagName("head")[0];c.appendChild(d);return},convertLatLonXY_Yahoo:function(p,a){var m=1<<(26-a);var c=m/360;var b=m/(2*Math.PI);var n=new YCoordPoint(m/2,m/2);var d=new YCoordPoint();d.x=Math.floor(n.x+p.lon*c);var o=Math.sin(p.lat*Math.PI/180);d.y=Math.floor(n.y+0.5*Math.log((1+o)/(1-o))*-b);return d},loadStyle:function(b){var a=document.createElement("link");a.type="text/css";a.rel="stylesheet";a.href=b;document.getElementsByTagName("head")[0].appendChild(a);return},getStyle:function(c,a){var b;if(c.currentStyle){b=c.currentStyle[a]}else{if(window.getComputedStyle){b=window.getComputedStyle(c,"").getPropertyValue(a)}}return b},lonToMetres:function(a,b){return a*(111200*Math.cos(b*(Math.PI/180)))},metresToLon:function(b,a){return b/(111200*Math.cos(a*(Math.PI/180)))},KMToMiles:function(a){return a/1.609344},milesToKM:function(a){return a*1.609344},getDegreesFromGoogleZoomLevel:function(a,b){return(360*a)/(Math.pow(2,b+8))},getGoogleZoomLevelFromDegrees:function(a,b){return f.util.logN((360*a)/b,2)-8},logN:function(b,a){return Math.log(b)/Math.log(a)},getAvailableProviders:function(){var a=[];for(var b in h){if(h.hasOwnProperty(b)){a.push(b)}}return a},stringFormat:function(a){var b=/\{\d+\}/g;var c=Array.slice.apply(arguments);c.shift();return a.replace(b,function(d){var k=d.slice(1,-1);return c[k]})}};f.util.Color=function(){if(arguments.length==3){this.red=arguments[0];this.green=arguments[1];this.blue=arguments[2]}else{if(arguments.length==1){this.setHexColor(arguments[0])}}};f.util.Color.prototype.reHex=/^#?([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/;f.util.Color.prototype.setHexColor=function(a){var b=a.match(this.reHex);if(b){a=b[1]}else{throw"Invalid HEX color format, expected #000, 000, #000000 or 000000"}if(a.length==3){a=a.replace(/\w/g,function(c){return c.concat(c)})}this.red=parseInt(a.substr(0,2),16);this.green=parseInt(a.substr(2,2),16);this.blue=parseInt(a.substr(4,2),16)};f.util.Color.prototype.getHexColor=function(){var a=this.blue|(this.green<<8)|(this.red<<16);var b=a.toString(16).toUpperCase();if(b.length<6){b="0"+b}return"#"+b}})();(function(){var $m=mxn.util.$m;var init=function(){this.invoker.go("init",[this.currentElement,this.api]);this.applyOptions()};var Mapstraction=mxn.Mapstraction=function(element,api,debug){if(!api){api=mxn.util.getAvailableProviders()[0]}this.api=api;this.maps={};this.currentElement=$m(element);this.eventListeners=[];this.markers=[];this.polylines=[];this.images=[];this.controls=[];this.loaded={};this.onload={};this.onload[api]=[];this.element=element;this.options={enableScrollWheelZoom:false,enableDragging:true};this.addControlsArgs={};this.invoker=new mxn.Invoker(this,"Mapstraction",function(){return this.api});mxn.addEvents(this,["load","click","endPan","changeZoom","markerAdded","markerRemoved","polylineAdded","polylineRemoved"]);init.apply(this)};Mapstraction.ROAD=1;Mapstraction.SATELLITE=2;Mapstraction.HYBRID=3;Mapstraction.PHYSICAL=4;mxn.addProxyMethods(Mapstraction,["addLargeControls","addMapTypeControls","addOverlay","addSmallControls","applyOptions","getBounds","getCenter","getMapType","getPixelRatio","getZoom","getZoomLevelForBoundingBox","mousePosition","resizeTo","setBounds","setCenter","setCenterAndZoom","setMapType","setZoom","toggleTileLayer"]);Mapstraction.prototype.setOptions=function(oOpts){mxn.util.merge(this.options,oOpts);this.applyOptions()};Mapstraction.prototype.setOption=function(sOptName,vVal){this.options[sOptName]=vVal;this.applyOptions()};Mapstraction.prototype.enableScrollWheelZoom=function(){this.setOption("enableScrollWheelZoom",true)};Mapstraction.prototype.dragging=function(on){this.setOption("enableDragging",on)};Mapstraction.prototype.swap=function(element,api){if(this.api===api){return}var center=this.getCenter();var zoom=this.getZoom();this.currentElement.style.visibility="hidden";this.currentElement.style.display="none";this.currentElement=$m(element);this.currentElement.style.visibility="visible";this.currentElement.style.display="block";this.api=api;this.onload[api]=[];if(this.maps[this.api]===undefined){init.apply(this);for(var i=0;i<this.markers.length;i++){this.addMarker(this.markers[i],true)}for(var j=0;j<this.polylines.length;j++){this.addPolyline(this.polylines[j],true)}this.setCenterAndZoom(center,zoom)}else{this.setCenterAndZoom(center,zoom)}this.addControls(this.addControlsArgs)};Mapstraction.prototype.isLoaded=function(api){if(api===null){api=this.api}return this.loaded[api]};Mapstraction.prototype.setDebug=function(debug){if(debug!==null){this.debug=debug}return this.debug};Mapstraction.prototype.setDefer=function(deferred){this.loaded[this.api]=!deferred};Mapstraction.prototype.runDeferred=function(){while(this.onload[this.api].length>0){this.onload[this.api].shift().apply(this)}};Mapstraction.prototype.clickHandler=function(lat,lon,me){this.callEventListeners("click",{location:new LatLonPoint(lat,lon)})};Mapstraction.prototype.moveendHandler=function(me){this.callEventListeners("moveend",{})};Mapstraction.prototype.addEventListener=function(){var listener={};listener.event_type=arguments[0];listener.callback_function=arguments[1];if(arguments.length==3){listener.back_compat_mode=false;listener.callback_object=arguments[2]}else{listener.back_compat_mode=true;listener.callback_object=null}this.eventListeners.push(listener)};Mapstraction.prototype.callEventListeners=function(sEventType,oEventArgs){oEventArgs.source=this;for(var i=0;i<this.eventListeners.length;i++){var evLi=this.eventListeners[i];if(evLi.event_type==sEventType){if(evLi.back_compat_mode){if(evLi.event_type=="click"){evLi.callback_function(oEventArgs.location)}else{evLi.callback_function()}}else{var scope=evLi.callback_object||this;evLi.callback_function.call(scope,oEventArgs)}}}};Mapstraction.prototype.addControls=function(args){this.addControlsArgs=args;this.invoker.go("addControls",arguments)};Mapstraction.prototype.addMarker=function(marker,old){marker.mapstraction=this;marker.api=this.api;marker.location.api=this.api;marker.map=this.maps[this.api];var propMarker=this.invoker.go("addMarker",arguments);marker.setChild(propMarker);if(!old){this.markers.push(marker)}this.markerAdded.fire({marker:marker})};Mapstraction.prototype.addMarkerWithData=function(marker,data){marker.addData(data);this.addMarker(marker)};Mapstraction.prototype.addPolylineWithData=function(polyline,data){polyline.addData(data);this.addPolyline(polyline)};Mapstraction.prototype.removeMarker=function(marker){var current_marker;for(var i=0;i<this.markers.length;i++){current_marker=this.markers[i];if(marker==current_marker){this.invoker.go("removeMarker",arguments);marker.onmap=false;this.markers.splice(i,1);this.markerRemoved.fire({marker:marker});break}}};Mapstraction.prototype.removeAllMarkers=function(){var current_marker;while(this.markers.length>0){current_marker=this.markers.pop();this.invoker.go("removeMarker",[current_marker])}};Mapstraction.prototype.declutterMarkers=function(opts){if(this.loaded[this.api]===false){var me=this;this.onload[this.api].push(function(){me.declutterMarkers(opts)});return}var map=this.maps[this.api];switch(this.api){case"multimap":map.declutterGroup(opts.groupName);break;case"  dummy":break;default:if(this.debug){alert(this.api+" not supported by Mapstraction.declutterMarkers")}}};Mapstraction.prototype.addPolyline=function(polyline,old){polyline.api=this.api;polyline.map=this.maps[this.api];var propPoly=this.invoker.go("addPolyline",arguments);polyline.setChild(propPoly);if(!old){this.polylines.push(polyline)}this.polylineAdded.fire({polyline:polyline})};var removePolylineImpl=function(polyline){this.invoker.go("removePolyline",arguments);polyline.onmap=false;this.polylineRemoved.fire({polyline:polyline})};Mapstraction.prototype.removePolyline=function(polyline){var current_polyline;for(var i=0;i<this.polylines.length;i++){current_polyline=this.polylines[i];if(polyline==current_polyline){this.polylines.splice(i,1);removePolylineImpl.call(this,polyline);break}}};Mapstraction.prototype.removeAllPolylines=function(){var current_polyline;while(this.polylines.length>0){current_polyline=this.polylines.pop();removePolylineImpl.call(this,current_polyline)}};Mapstraction.prototype.autoCenterAndZoom=function(){var lat_max=-90;var lat_min=90;var lon_max=-180;var lon_min=180;var lat,lon;var checkMinMax=function(){if(lat>lat_max){lat_max=lat}if(lat<lat_min){lat_min=lat}if(lon>lon_max){lon_max=lon}if(lon<lon_min){lon_min=lon}};for(var i=0;i<this.markers.length;i++){lat=this.markers[i].location.lat;lon=this.markers[i].location.lon;checkMinMax()}for(i=0;i<this.polylines.length;i++){for(var j=0;j<this.polylines[i].points.length;j++){lat=this.polylines[i].points[j].lat;lon=this.polylines[i].points[j].lon;checkMinMax()}}this.setBounds(new BoundingBox(lat_min,lon_min,lat_max,lon_max))};Mapstraction.prototype.centerAndZoomOnPoints=function(points){var bounds=new BoundingBox(points[0].lat,points[0].lon,points[0].lat,points[0].lon);for(var i=1,len=points.length;i<len;i++){bounds.extend(points[i])}this.setBounds(bounds)};Mapstraction.prototype.visibleCenterAndZoom=function(){var lat_max=-90;var lat_min=90;var lon_max=-180;var lon_min=180;var lat,lon;var checkMinMax=function(){if(lat>lat_max){lat_max=lat}if(lat<lat_min){lat_min=lat}if(lon>lon_max){lon_max=lon}if(lon<lon_min){lon_min=lon}};for(var i=0;i<this.markers.length;i++){if(this.markers[i].getAttribute("visible")){lat=this.markers[i].location.lat;lon=this.markers[i].location.lon;checkMinMax()}}for(i=0;i<this.polylines.length;i++){if(this.polylines[i].getAttribute("visible")){for(j=0;j<this.polylines[i].points.length;j++){lat=this.polylines[i].points[j].lat;lon=this.polylines[i].points[j].lon;checkMinMax()}}}this.setBounds(new BoundingBox(lat_min,lon_min,lat_max,lon_max))};Mapstraction.prototype.polylineCenterAndZoom=function(radius){var lat_max=-90;var lat_min=90;var lon_max=-180;var lon_min=180;for(var i=0;i<mapstraction.polylines.length;i++){for(var j=0;j<mapstraction.polylines[i].points.length;j++){lat=mapstraction.polylines[i].points[j].lat;lon=mapstraction.polylines[i].points[j].lon;latConv=lonConv=radius;if(radius>0){latConv=(radius/mapstraction.polylines[i].points[j].latConv());lonConv=(radius/mapstraction.polylines[i].points[j].lonConv())}if((lat+latConv)>lat_max){lat_max=(lat+latConv)}if((lat-latConv)<lat_min){lat_min=(lat-latConv)}if((lon+lonConv)>lon_max){lon_max=(lon+lonConv)}if((lon-lonConv)<lon_min){lon_min=(lon-lonConv)}}}this.setBounds(new BoundingBox(lat_min,lon_min,lat_max,lon_max))};Mapstraction.prototype.addImageOverlay=function(id,src,opacity,west,south,east,north){var b=document.createElement("img");b.style.display="block";b.setAttribute("id",id);b.setAttribute("src",src);b.style.position="absolute";b.style.zIndex=1;b.setAttribute("west",west);b.setAttribute("south",south);b.setAttribute("east",east);b.setAttribute("north",north);var oContext={imgElm:b};this.invoker.go("addImageOverlay",arguments,{context:oContext})};Mapstraction.prototype.setImageOpacity=function(id,opacity){if(opacity<0){opacity=0}if(opacity>=100){opacity=100}var c=opacity/100;var d=document.getElementById(id);if(typeof(d.style.filter)=="string"){d.style.filter="alpha(opacity:"+opacity+")"}if(typeof(d.style.KHTMLOpacity)=="string"){d.style.KHTMLOpacity=c}if(typeof(d.style.MozOpacity)=="string"){d.style.MozOpacity=c}if(typeof(d.style.opacity)=="string"){d.style.opacity=c}};Mapstraction.prototype.setImagePosition=function(id){var imgElement=document.getElementById(id);var oContext={latLng:{top:imgElement.getAttribute("north"),left:imgElement.getAttribute("west"),bottom:imgElement.getAttribute("south"),right:imgElement.getAttribute("east")},pixels:{top:0,right:0,bottom:0,left:0}};this.invoker.go("setImagePosition",arguments,{context:oContext});imgElement.style.top=oContext.pixels.top.toString()+"px";imgElement.style.left=oContext.pixels.left.toString()+"px";imgElement.style.width=(oContext.pixels.right-oContext.pixels.left).toString()+"px";imgElement.style.height=(oContext.pixels.bottom-oContext.pixels.top).toString()+"px"};Mapstraction.prototype.addJSON=function(json){var features;if(typeof(json)=="string"){features=eval("("+json+")")}else{features=json}features=features.features;var map=this.maps[this.api];var html="";var item;var polyline;var marker;var markers=[];if(features.type=="FeatureCollection"){this.addJSON(features.features)}for(var i=0;i<features.length;i++){item=features[i];switch(item.geometry.type){case"Point":html="<strong>"+item.title+"</strong><p>"+item.description+"</p>";marker=new Marker(new LatLonPoint(item.geometry.coordinates[1],item.geometry.coordinates[0]));markers.push(marker);this.addMarkerWithData(marker,{infoBubble:html,label:item.title,date:'new Date("'+item.date+'")',iconShadow:item.icon_shadow,marker:item.id,iconShadowSize:item.icon_shadow_size,icon:item.icon,iconSize:item.icon_size,category:item.source_id,draggable:false,hover:false});break;case"Polygon":var points=[];polyline=new Polyline(points);mapstraction.addPolylineWithData(polyline,{fillColor:item.poly_color,date:'new Date("'+item.date+'")',category:item.source_id,width:item.line_width,opacity:item.line_opacity,color:item.line_color,polygon:true});markers.push(polyline);break;default:}}return markers};Mapstraction.prototype.addTileLayer=function(tile_url,opacity,copyright_text,min_zoom,max_zoom,map_type){if(!tile_url){return}this.tileLayers=this.tileLayers||[];opacity=opacity||0.6;copyright_text=copyright_text||"Mapstraction";min_zoom=min_zoom||1;max_zoom=max_zoom||18;map_type=map_type||false;return this.invoker.go("addTileLayer",[tile_url,opacity,copyright_text,min_zoom,max_zoom,map_type])};Mapstraction.prototype.addFilter=function(field,operator,value){if(!this.filters){this.filters=[]}this.filters.push([field,operator,value])};Mapstraction.prototype.removeFilter=function(field,operator,value){if(!this.filters){return}var del;for(var f=0;f<this.filters.length;f++){if(this.filters[f][0]==field&&(!operator||(this.filters[f][1]==operator&&this.filters[f][2]==value))){this.filters.splice(f,1);f--}}};Mapstraction.prototype.toggleFilter=function(field,operator,value){if(!this.filters){this.filters=[]}var found=false;for(var f=0;f<this.filters.length;f++){if(this.filters[f][0]==field&&this.filters[f][1]==operator&&this.filters[f][2]==value){this.filters.splice(f,1);f--;found=true}}if(!found){this.addFilter(field,operator,value)}};Mapstraction.prototype.removeAllFilters=function(){this.filters=[]};Mapstraction.prototype.doFilter=function(showCallback,hideCallback){var map=this.maps[this.api];var visibleCount=0;var f;if(this.filters){switch(this.api){case"multimap":var mmfilters=[];for(f=0;f<this.filters.length;f++){mmfilters.push(new MMSearchFilter(this.filters[f][0],this.filters[f][1],this.filters[f][2]))}map.setMarkerFilters(mmfilters);map.redrawMap();break;case"  dummy":break;default:var vis;for(var m=0;m<this.markers.length;m++){vis=true;for(f=0;f<this.filters.length;f++){if(!this.applyFilter(this.markers[m],this.filters[f])){vis=false}}if(vis){visibleCount++;if(showCallback){showCallback(this.markers[m])}else{this.markers[m].show()}}else{if(hideCallback){hideCallback(this.markers[m])}else{this.markers[m].hide()}}this.markers[m].setAttribute("visible",vis)}break}}return visibleCount};Mapstraction.prototype.applyFilter=function(o,f){var vis=true;switch(f[1]){case"ge":if(o.getAttribute(f[0])<f[2]){vis=false}break;case"le":if(o.getAttribute(f[0])>f[2]){vis=false}break;case"eq":if(o.getAttribute(f[0])==f[2]){vis=false}break}return vis};Mapstraction.prototype.getAttributeExtremes=function(field){var min;var max;for(var m=0;m<this.markers.length;m++){if(!min||min>this.markers[m].getAttribute(field)){min=this.markers[m].getAttribute(field)}if(!max||max<this.markers[m].getAttribute(field)){max=this.markers[m].getAttribute(field)}}for(var p=0;m<this.polylines.length;m++){if(!min||min>this.polylines[p].getAttribute(field)){min=this.polylines[p].getAttribute(field)}if(!max||max<this.polylines[p].getAttribute(field)){max=this.polylines[p].getAttribute(field)}}return[min,max]};Mapstraction.prototype.getMap=function(){return this.maps[this.api]};var LatLonPoint=mxn.LatLonPoint=function(lat,lon){this.lat=lat;this.lon=lon;this.lng=lon;this.invoker=new mxn.Invoker(this,"LatLonPoint")};mxn.addProxyMethods(LatLonPoint,["fromProprietary","toProprietary"],true);LatLonPoint.prototype.toString=function(){return this.lat+", "+this.lon};LatLonPoint.prototype.distance=function(otherPoint){var rads=Math.PI/180;var diffLat=(this.lat-otherPoint.lat)*rads;var diffLon=(this.lon-otherPoint.lon)*rads;var a=Math.sin(diffLat/2)*Math.sin(diffLat/2)+Math.cos(this.lat*rads)*Math.cos(otherPoint.lat*rads)*Math.sin(diffLon/2)*Math.sin(diffLon/2);return 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))*6371};LatLonPoint.prototype.equals=function(otherPoint){return this.lat==otherPoint.lat&&this.lon==otherPoint.lon};LatLonPoint.prototype.latConv=function(){return this.distance(new LatLonPoint(this.lat+0.1,this.lon))*10};LatLonPoint.prototype.lonConv=function(){return this.distance(new LatLonPoint(this.lat,this.lon+0.1))*10};var BoundingBox=mxn.BoundingBox=function(swlat,swlon,nelat,nelon){this.sw=new LatLonPoint(swlat,swlon);this.ne=new LatLonPoint(nelat,nelon)};BoundingBox.prototype.getSouthWest=function(){return this.sw};BoundingBox.prototype.getNorthEast=function(){return this.ne};BoundingBox.prototype.isEmpty=function(){return this.ne==this.sw};BoundingBox.prototype.contains=function(point){return point.lat>=this.sw.lat&&point.lat<=this.ne.lat&&point.lon>=this.sw.lon&&point.lon<=this.ne.lon};BoundingBox.prototype.toSpan=function(){return new LatLonPoint(Math.abs(this.sw.lat-this.ne.lat),Math.abs(this.sw.lon-this.ne.lon))};BoundingBox.prototype.extend=function(point){if(this.sw.lat>point.lat){this.sw.lat=point.lat}if(this.sw.lon>point.lon){this.sw.lon=point.lon}if(this.ne.lat<point.lat){this.ne.lat=point.lat}if(this.ne.lon<point.lon){this.ne.lon=point.lon}return};var Marker=mxn.Marker=function(point){this.api=null;this.location=point;this.onmap=false;this.proprietary_marker=false;this.attributes=[];this.invoker=new mxn.Invoker(this,"Marker",function(){return this.api});mxn.addEvents(this,["openInfoBubble","closeInfoBubble","click"])};mxn.addProxyMethods(Marker,["fromProprietary","hide","openBubble","closeBubble","show","toProprietary","update"]);Marker.prototype.setChild=function(some_proprietary_marker){this.proprietary_marker=some_proprietary_marker;some_proprietary_marker.mapstraction_marker=this;this.onmap=true};Marker.prototype.setLabel=function(labelText){this.labelText=labelText};Marker.prototype.addData=function(options){for(var sOptKey in options){if(options.hasOwnProperty(sOptKey)){switch(sOptKey){case"label":this.setLabel(options.label);break;case"infoBubble":this.setInfoBubble(options.infoBubble);break;case"icon":if(options.iconSize&&options.iconAnchor){this.setIcon(options.icon,options.iconSize,options.iconAnchor)}else{if(options.iconSize){this.setIcon(options.icon,options.iconSize)}else{this.setIcon(options.icon)}}break;case"iconShadow":if(options.iconShadowSize){this.setShadowIcon(options.iconShadow,[options.iconShadowSize[0],options.iconShadowSize[1]])}else{this.setIcon(options.iconShadow)}break;case"infoDiv":this.setInfoDiv(options.infoDiv[0],options.infoDiv[1]);break;case"draggable":this.setDraggable(options.draggable);break;case"hover":this.setHover(options.hover);this.setHoverIcon(options.hoverIcon);break;case"hoverIcon":this.setHoverIcon(options.hoverIcon);break;case"openBubble":this.openBubble();break;case"closeBubble":this.closeBubble();break;case"groupName":this.setGroupName(options.groupName);break;default:this.setAttribute(sOptKey,options[sOptKey]);break}}}};Marker.prototype.setInfoBubble=function(infoBubble){this.infoBubble=infoBubble};Marker.prototype.setInfoDiv=function(infoDiv,div){this.infoDiv=infoDiv;this.div=div};Marker.prototype.setIcon=function(iconUrl,iconSize,iconAnchor){this.iconUrl=iconUrl;if(iconSize){this.iconSize=iconSize}if(iconAnchor){this.iconAnchor=iconAnchor}};Marker.prototype.setIconSize=function(iconSize){if(iconSize){this.iconSize=iconSize}};Marker.prototype.setIconAnchor=function(iconAnchor){if(iconAnchor){this.iconAnchor=iconAnchor}};Marker.prototype.setShadowIcon=function(iconShadowUrl,iconShadowSize){this.iconShadowUrl=iconShadowUrl;if(iconShadowSize){this.iconShadowSize=iconShadowSize}};Marker.prototype.setHoverIcon=function(hoverIconUrl){this.hoverIconUrl=hoverIconUrl};Marker.prototype.setDraggable=function(draggable){this.draggable=draggable};Marker.prototype.setHover=function(hover){this.hover=hover};Marker.prototype.setGroupName=function(sGrpName){this.groupName=sGrpName};Marker.prototype.setAttribute=function(key,value){this.attributes[key]=value};Marker.prototype.getAttribute=function(key){return this.attributes[key]};var Polyline=mxn.Polyline=function(points){this.api=null;this.points=points;this.attributes=[];this.onmap=false;this.proprietary_polyline=false;this.pllID="mspll-"+new Date().getTime()+"-"+(Math.floor(Math.random()*Math.pow(2,16)));this.invoker=new mxn.Invoker(this,"Polyline",function(){return this.api})};mxn.addProxyMethods(Polyline,["fromProprietary","hide","show","toProprietary","update"]);Polyline.prototype.addData=function(options){for(var sOpt in options){if(options.hasOwnProperty(sOpt)){switch(sOpt){case"color":this.setColor(options.color);break;case"width":this.setWidth(options.width);break;case"opacity":this.setOpacity(options.opacity);break;case"closed":this.setClosed(options.closed);break;case"fillColor":this.setFillColor(options.fillColor);break;default:this.setAttribute(sOpt,options[sOpt]);break}}}};Polyline.prototype.setChild=function(some_proprietary_polyline){this.proprietary_polyline=some_proprietary_polyline;this.onmap=true};Polyline.prototype.setColor=function(color){this.color=(color.length==7&&color[0]=="#")?color.toUpperCase():color};Polyline.prototype.setWidth=function(width){this.width=width};Polyline.prototype.setOpacity=function(opacity){this.opacity=opacity};Polyline.prototype.setClosed=function(bClosed){this.closed=bClosed};Polyline.prototype.setFillColor=function(sFillColor){this.fillColor=sFillColor};Polyline.prototype.setAttribute=function(key,value){this.attributes[key]=value};Polyline.prototype.getAttribute=function(key){return this.attributes[key]};Polyline.prototype.simplify=function(tolerance){var reduced=[];reduced[0]=this.points[0];var markerPoint=0;for(var i=1;i<this.points.length-1;i++){if(this.points[i].distance(this.points[markerPoint])>=tolerance){reduced[reduced.length]=this.points[i];markerPoint=i}}reduced[reduced.length]=this.points[this.points.length-1];this.points=reduced};var Radius=mxn.Radius=function(center,quality){this.center=center;var latConv=center.latConv();var lonConv=center.lonConv();var rad=Math.PI/180;this.calcs=[];for(var i=0;i<360;i+=quality){this.calcs.push([Math.cos(i*rad)/latConv,Math.sin(i*rad)/lonConv])}};Radius.prototype.getPolyline=function(radius,color){var points=[];for(var i=0;i<this.calcs.length;i++){var point=new LatLonPoint(this.center.lat+(radius*this.calcs[i][0]),this.center.lon+(radius*this.calcs[i][1]));points.push(point)}points.push(points[0]);var line=new Polyline(points);line.setColor(color);return line}})();mxn.register("googlev3",{Mapstraction:{init:function(g,m){var l=this;if(google&&google.maps){var h={disableDefaultUI:true,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:false,mapTypeControlOptions:null,navigationControl:false,navigationControlOptions:null,scrollwheel:false};if(!this.addControlsArgs&&loadoptions.addControlsArgs){this.addControlsArgs=loadoptions.addControlsArgs}if(this.addControlsArgs){if(this.addControlsArgs.zoom){h.navigationControl=true;if(this.addControlsArgs.zoom=="small"){h.navigationControlOptions={style:google.maps.NavigationControlStyle.SMALL}}if(this.addControlsArgs.zoom=="large"){h.navigationControlOptions={style:google.maps.NavigationControlStyle.ZOOM_PAN}}}if(this.addControlsArgs.map_type){h.mapTypeControl=true;h.mapTypeControlOptions={style:google.maps.MapTypeControlStyle.DEFAULT}}}var k=new google.maps.Map(g,h);google.maps.event.addListener(k,"click",function(a){l.click.fire({location:new mxn.LatLonPoint(a.latLng.lat(),a.latLng.lng())})});google.maps.event.addListener(k,"zoom_changed",function(){l.changeZoom.fire()});google.maps.event.addListener(k,"dragend",function(){l.moveendHandler(l);l.endPan.fire()});var i=google.maps.event.addListener(k,"tilesloaded",function(){l.load.fire();google.maps.event.removeListener(i)});this.maps[m]=k;this.loaded[m]=true}else{alert(m+" map script not imported")}},applyOptions:function(){var c=this.maps[this.api];var d=[];if(this.options.enableDragging){d.draggable=true}if(this.options.enableScrollWheelZoom){d.scrollwheel=true}c.setOptions(d)},resizeTo:function(d,e){this.currentElement.style.width=d;this.currentElement.style.height=e;var f=this.maps[this.api];google.maps.event.trigger(f,"resize")},addControls:function(d){var f=this.maps[this.api];if(d.zoom||d.pan){if(d.zoom=="large"){this.addLargeControls()}else{this.addSmallControls()}}if(d.scale){var e={scaleControl:true,scaleControlOptions:{style:google.maps.ScaleControlStyle.DEFAULT}};f.setOptions(e);this.addControlsArgs.scale=true}if(d.map_type){this.addMapTypeControls()}},addSmallControls:function(){var c=this.maps[this.api];var d={navigationControl:true,navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL}};c.setOptions(d);this.addControlsArgs.pan=false;this.addControlsArgs.scale=false;this.addControlsArgs.zoom="small"},addLargeControls:function(){var c=this.maps[this.api];var d={navigationControl:true,navigationControlOptions:{style:google.maps.NavigationControlStyle.DEFAULT}};c.setOptions(d);this.addControlsArgs.pan=true;this.addControlsArgs.zoom="large"},addMapTypeControls:function(){var c=this.maps[this.api];var d={mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT}};c.setOptions(d);this.addControlsArgs.map_type=true},setCenterAndZoom:function(f,e){var g=this.maps[this.api];var h=f.toProprietary(this.api);g.setCenter(h);g.setZoom(e)},addMarker:function(c,d){return c.toProprietary(this.api)},removeMarker:function(b){b.hide()},declutterMarkers:function(d){var c=this.maps[this.api]},addPolyline:function(h,e){var g=this.maps[this.api];var f=h.toProprietary(this.api);f.setMap(g);return f},removePolyline:function(d){var c=this.maps[this.api];d.proprietary_polyline.setMap(null)},getCenter:function(){var c=this.maps[this.api];var d=c.getCenter();return new mxn.LatLonPoint(d.lat(),d.lng())},setCenter:function(f,e){var g=this.maps[this.api];var h=f.toProprietary(this.api);if(e&&e.pan){g.panTo(h)}else{g.setCenter(h)}},setZoom:function(d){var c=this.maps[this.api];c.setZoom(d)},getZoom:function(){var b=this.maps[this.api];return b.getZoom()},getZoomLevelForBoundingBox:function(h){var i=this.maps[this.api];var g=h.getSouthWest().toProprietary(this.api);var k=h.getNorthEast().toProprietary(this.api);var f=new google.maps.LatLngBounds(g,k);i.fitBounds(f);return i.getZoom()},setMapType:function(d){var c=this.maps[this.api];switch(d){case mxn.Mapstraction.ROAD:c.setMapTypeId(google.maps.MapTypeId.ROADMAP);break;case mxn.Mapstraction.SATELLITE:c.setMapTypeId(google.maps.MapTypeId.SATELLITE);break;case mxn.Mapstraction.HYBRID:c.setMapTypeId(google.maps.MapTypeId.HYBRID);break;case mxn.Mapstraction.PHYSICAL:c.setMapTypeId(google.maps.MapTypeId.TERRAIN);break;default:c.setMapTypeId(google.maps.MapTypeId.ROADMAP)}},getMapType:function(){var c=this.maps[this.api];var d=c.getMapTypeId();switch(d){case google.maps.MapTypeId.ROADMAP:return mxn.Mapstraction.ROAD;case google.maps.MapTypeId.SATELLITE:return mxn.Mapstraction.SATELLITE;case google.maps.MapTypeId.HYBRID:return mxn.Mapstraction.HYBRID;case google.maps.MapTypeId.TERRAIN:return mxn.Mapstraction.PHYSICAL;default:return null}},getBounds:function(){var g=this.maps[this.api];var h=g.getBounds();if(!h){throw"Bounds not available, map must be initialized"}var f=h.getSouthWest();var e=h.getNorthEast();return new mxn.BoundingBox(f.lat(),f.lng(),e.lat(),e.lng())},setBounds:function(f){var h=this.maps[this.api];var g=f.getSouthWest().toProprietary(this.api);var i=f.getNorthEast().toProprietary(this.api);var k=new google.maps.LatLngBounds(g,i);h.fitBounds(k)},addImageOverlay:function(t,v,q,l,p,n,r,m){var u=this.maps[this.api];var o=new google.maps.LatLngBounds(new google.maps.LatLng(p,l),new google.maps.LatLng(r,n));var s=new google.maps.GroundOverlay(v,o);s.setMap(u)},setImagePosition:function(c,d){},addOverlay:function(g,i){var h=this.maps[this.api];var k={preserveViewport:(!i)};var f=new google.maps.KmlLayer(g,k);f.setMap(h)},addTileLayer:function(p,u,w,q,t,o){var z=this.maps[this.api];var r=[];var s=this.tileLayers.length||0;r[0]={getTileUrl:function(b,a){url=p;url=url.replace(/\{Z\}/g,a);url=url.replace(/\{X\}/g,b.x);url=url.replace(/\{Y\}/g,b.y);return url},tileSize:new google.maps.Size(256,256),isPng:true,minZoom:q,maxZoom:t,opacity:u,name:w};var f=new google.maps.ImageMapType(r[0]);if(o){z.mapTypes.set("tile"+s,f);var x=[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.HYBRID,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.TERRAIN];for(var v=0;v<this.tileLayers.length;v++){x.push("tile"+v)}var y={mapTypeControlOptions:{mapTypeIds:x}};z.setOptions(y)}else{z.overlayMapTypes.insertAt(s,f)}this.tileLayers.push([p,f,true,s]);return f},toggleTileLayer:function(g){var e=this.maps[this.api];for(var f=0;f<this.tileLayers.length;f++){var h=this.tileLayers[f];if(h[0]==g){if(h[2]){e.overlayMapTypes.removeAt(h[3]);h[2]=false}else{e.overlayMapTypes.insertAt(h[3],h[1]);h[2]=true}}}},getPixelRatio:function(){var b=this.maps[this.api]},mousePosition:function(e){var d=this.maps[this.api];var f=document.getElementById(e);if(f!==null){google.maps.event.addListener(d,"mousemove",function(b){var a=b.latLng.lat().toFixed(4)+" / "+b.latLng.lng().toFixed(4);f.innerHTML=a});f.innerHTML="0.0000 / 0.0000"}}},LatLonPoint:{toProprietary:function(){return new google.maps.LatLng(this.lat,this.lon)},fromProprietary:function(b){this.lat=b.lat();this.lon=b.lng()}},Marker:{toProprietary:function(){var m={};var w=0;var n=0;if(this.iconAnchor){w=this.iconAnchor[0];n=this.iconAnchor[1]}var t=new google.maps.Point(w,n);if(this.iconUrl){m.icon=new google.maps.MarkerImage(this.iconUrl,new google.maps.Size(this.iconSize[0],this.iconSize[1]),new google.maps.Point(0,0),t);if(this.iconShadowUrl){if(this.iconShadowSize){var p=this.iconShadowSize[0];var q=this.iconShadowSize[1];m.shadow=new google.maps.MarkerImage(this.iconShadowUrl,new google.maps.Size(p,q),new google.maps.Point(0,0),t)}else{m.shadow=new google.maps.MarkerImage(this.iconShadowUrl)}}}if(this.draggable){m.draggable=this.draggable}if(this.labelText){m.title=this.labelText}if(this.imageMap){m.shape={coord:this.imageMap,type:"poly"}}m.position=this.location.toProprietary(this.api);m.map=this.map;var s=new google.maps.Marker(m);if(this.infoBubble){var r="click";if(this.hover){r="mouseover"}google.maps.event.addListener(s,r,function(){s.mapstraction_marker.openBubble()})}if(this.hoverIconUrl){var u=new google.maps.Size(this.iconSize[0],this.iconSize[1]);var o=new google.maps.Point(0,0);var x=new google.maps.MarkerImage(this.hoverIconUrl,u,o,t);var v=new google.maps.MarkerImage(this.iconUrl,u,o,t);google.maps.event.addListener(s,"mouseover",function(){s.setIcon(x)});google.maps.event.addListener(s,"mouseout",function(){s.setIcon(v)})}google.maps.event.addListener(s,"click",function(){s.mapstraction_marker.click.fire()});return s},openBubble:function(){var b=new google.maps.InfoWindow({content:this.infoBubble});google.maps.event.addListener(b,"closeclick",function(a){});this.openInfoBubble.fire({marker:this});b.open(this.map,this.proprietary_marker);this.proprietary_infowindow=b},closeBubble:function(){if(this.hasOwnProperty("proprietary_infowindow")){this.proprietary_infowindow.close();this.closeInfoBubble.fire({marker:this})}},hide:function(){this.proprietary_marker.setOptions({visible:false})},show:function(){this.proprietary_marker.setOptions({visible:true})},update:function(){var b=new mxn.LatLonPoint();b.fromProprietary("googlev3",this.proprietary_marker.getPosition());this.location=b}},Polyline:{toProprietary:function(){var i=[];for(var k=0,h=this.points.length;k<h;k++){i.push(this.points[k].toProprietary("googlev3"))}var f={path:i,strokeColor:this.color||"#000000",strokeOpacity:1,strokeWeight:3};var g=new google.maps.Polyline(f);return g},show:function(){throw"Not implemented"},hide:function(){throw"Not implemented"}}});